{% load post_tags %}
<div class="post-card mb-4 p-3 bg-white shadow-sm rounded border">
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h4 class="mb-0">
      <a href="{% url 'post_view' post.id %}" class=" h5 mb-0 text-decoration-none">
        {{ post.title }}
      </a>
    </h4>
    <small class="text-muted">{{ post.created_at|date:"M d, Y H:i" }}</small>
  </div>
  <p class="text-muted mb-1">
    <a class="font-weight-bold" href="{% url 'communities' post.community.name %}">r/{{ post.community.name }}</a> â€¢
    Posted by
    <a class="font-weight-bold" href="{% url 'profile' post.user.username %}">{{ post.user.username }}</a>
  </p>
  <p>{{ post.body }}</p>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <span class="badge bg-secondary">Votes: {{ post.votes }}</span>
    <div class="post-actions d-flex gap-1">
      {% with post.votedby|get_vote:user.username as user_vote %}
      <form method="post" action="{% url 'post_view' post.id %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-primary" title="Comment">
          <i class="bi bi-chat"></i>
        </button>
      </form>
      <form method="post" action="{% url 'vote_post' post.id 'up' %}">
        {% csrf_token %}
        {% if user_vote == "up" %}
        <button class="btn btn-sm btn-success" title="Upvoted">
          <i class="bi bi-arrow-up-circle-fill"></i>
        </button>
        {% else %}
        <button class="btn btn-sm btn-outline-secondary" title="Upvote">
          <i class="bi bi-arrow-up-circle"></i>
        </button>
        {% endif %}
      </form>

      <form method="post" action="{% url 'vote_post' post.id 'down' %}">
        {% csrf_token %}
        {% if user_vote == "down" %}
        <button class="btn btn-sm btn-danger" title="Downvoted">
          <i class="bi bi-arrow-down-circle-fill"></i>
        </button>
        {% else %}
        <button class="btn btn-sm btn-outline-secondary" title="Downvote">
          <i class="bi bi-arrow-down-circle"></i>
        </button>
        {% endif %}
      </form>
      {% endwith %}
      {% if user == post.user %}
      <form method="post" action="{% url 'delete_post' post.id %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
      </form>
      {% endif %}
    </div>
  </div>
</div>